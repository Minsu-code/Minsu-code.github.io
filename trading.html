<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal - Tony An</title>
    <style>
        :root {
            --bg-primary: #f5f5f5;
            --bg-secondary: white;
            --bg-card: #fafafa;
            --text-primary: #222;
            --text-secondary: #666;
            --text-muted: #888;
            --border-color: #e0e0e0;
            --accent-color: #333;
            --hover-bg: #f0f0f0;
            --shadow: rgba(0,0,0,0.08);
            --profit-color: #4caf50;
            --loss-color: #e53935;
        }

        [data-theme="dark"] {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-card: #2a2a2a;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-muted: #888;
            --border-color: #404040;
            --accent-color: #e0e0e0;
            --hover-bg: #333;
            --shadow: rgba(0,0,0,0.3);
            --profit-color: #66bb6a;
            --loss-color: #ef5350;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg-primary); 
            min-height: 100vh; 
            transition: background 0.3s, color 0.3s;
        }
        
        /* ÏÉÅÎã®Î∞î */
        .top-bar {
            background: #1a1a1a;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .left-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .social-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: opacity 0.2s;
        }
        
        .social-link:hover {
            opacity: 0.8;
        }
        
        .x-logo {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            padding: 5px;
            transition: transform 0.2s;
        }

        .theme-toggle:hover {
            transform: scale(1.2);
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            padding: 8px 20px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            opacity: 0.7;
        }

        .visitor-count {
            color: white;
            font-size: 14px;
            font-weight: 500;
        }
        
        .main-content {
            padding: 30px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-title {
            font-size: 28px;
            color: var(--text-primary);
            margin-bottom: 30px;
            text-align: center;
            transition: color 0.3s;
        }

        /* ÌÜµÍ≥Ñ Ïπ¥Îìú */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px var(--shadow);
            transition: background 0.3s;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            transition: color 0.3s;
        }

        .stat-value.profit {
            color: var(--profit-color);
        }

        .stat-value.loss {
            color: var(--loss-color);
        }

        /* ÏûÖÎ†• Ìèº */
        .form-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px var(--shadow);
            transition: background 0.3s;
        }

        .form-title {
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 20px;
            transition: color 0.3s;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            transition: color 0.3s;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .btn {
            background: var(--accent-color);
            color: var(--bg-secondary);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            opacity: 0.8;
        }

        .btn-container {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        /* ÌÖåÏù¥Î∏î */
        .table-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 2px 10px var(--shadow);
            overflow-x: auto;
            transition: background 0.3s;
            margin-bottom: 30px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-title {
            font-size: 18px;
            color: var(--text-primary);
            transition: color 0.3s;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: border-color 0.3s;
        }

        th {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            background: var(--bg-card);
        }

        td {
            font-size: 14px;
            color: var(--text-primary);
            transition: color 0.3s;
        }

        tr:hover {
            background: var(--hover-bg);
        }

        .type-buy {
            color: var(--profit-color);
            font-weight: 500;
        }

        .type-sell {
            color: var(--loss-color);
            font-weight: 500;
        }

        .profit-positive {
            color: var(--profit-color);
            font-weight: 600;
        }

        .profit-negative {
            color: var(--loss-color);
            font-weight: 600;
        }

        .memo-cell {
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
            transition: color 0.2s;
        }

        .delete-btn:hover {
            color: #e53935;
        }

        .empty-message {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        /* ÏãúÎìúÎ®∏Îãà */
        .seed-container {
            margin-bottom: 30px;
        }

        .seed-card {
            background: #2a2a2a;
            border-radius: 16px;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }

        [data-theme="dark"] .seed-card {
            background: #1a1a1a;
        }

        .seed-info {
            color: white;
            position: relative;
        }

        .cash-edit-btn {
            background: none;
            border: none;
            font-size: 14px;
            cursor: pointer;
            padding: 4px;
            transition: transform 0.2s;
            position: absolute;
            top: 0;
            right: -25px;
        }

        .cash-edit-btn:hover {
            transform: scale(1.2);
        }

        .seed-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .seed-value {
            font-size: 28px;
            font-weight: 700;
        }

        .seed-value.krw {
            font-size: 24px;
        }

        .seed-krw {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .seed-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .seed-btn {
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .seed-btn.add {
            background: #4caf50;
            color: white;
        }

        .seed-btn.remove {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .seed-btn.exchange {
            background: #ff9800;
            color: white;
        }

        .seed-btn.history {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .seed-btn:hover {
            transform: scale(1.05);
        }

        .rate-edit-btn {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.2s;
        }

        .rate-edit-btn:hover {
            transform: scale(1.2);
        }

        .exchange-rate-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px var(--shadow);
            transition: background 0.3s;
        }

        .rate-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .rate-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .rate-input-group input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background: var(--bg-card);
            color: var(--text-primary);
            text-align: right;
            transition: all 0.3s;
        }

        .exchange-preview {
            background: var(--bg-card);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* ÌÜµÍ≥Ñ Ìó§Îçî */
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stats-title {
            font-size: 18px;
            color: var(--text-primary);
            margin: 0;
            transition: color 0.3s;
        }

        .period-filter {
            display: flex;
            gap: 5px;
            background: var(--bg-secondary);
            padding: 5px;
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .period-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            background: transparent;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .period-btn:hover {
            background: var(--hover-bg);
        }

        .period-btn.active {
            background: var(--accent-color);
            color: var(--bg-secondary);
        }

        .seed-history-container {
            margin-bottom: 30px;
        }

        .type-add {
            color: var(--profit-color);
            font-weight: 500;
        }

        .type-remove {
            color: var(--loss-color);
            font-weight: 500;
        }

        .type-exchange {
            color: #ff9800;
            font-weight: 500;
        }

        /* Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏÑπÏÖò */
        .portfolio-container {
            margin-bottom: 30px;
        }

        .portfolio-table-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 2px 10px var(--shadow);
            overflow-x: auto;
            transition: background 0.3s;
        }

        .portfolio-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        .portfolio-table th,
        .portfolio-table td {
            padding: 12px 10px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }

        .portfolio-table th:first-child,
        .portfolio-table td:first-child {
            text-align: left;
        }

        .portfolio-table th {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            background: var(--bg-card);
            text-transform: uppercase;
        }

        .portfolio-table td {
            font-size: 14px;
            color: var(--text-primary);
        }

        .portfolio-table tbody tr:hover {
            background: var(--hover-bg);
        }

        .portfolio-ticker-cell {
            font-weight: 700;
            font-size: 15px;
        }

        .current-price-cell {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 5px;
        }

        .current-price-input {
            width: 90px;
            padding: 6px 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            background: var(--bg-card);
            color: var(--text-primary);
            text-align: right;
        }

        .current-price-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .price-edit-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            transition: transform 0.2s;
            opacity: 0.7;
        }

        .price-edit-btn:hover {
            transform: scale(1.2);
            opacity: 1;
        }

        .portfolio-empty {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .portfolio-total-row {
            font-weight: 600;
            background: var(--bg-card);
        }

        .portfolio-total-row td {
            padding-top: 15px;
            padding-bottom: 15px;
            font-size: 15px;
        }

        /* Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title {
            font-size: 20px;
            color: var(--text-primary);
            margin-bottom: 20px;
            transition: color 0.3s;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons .btn {
            flex: 1;
        }

        .modal-buttons .btn.cancel {
            background: var(--border-color);
            color: var(--text-secondary);
        }

        .modal-buttons .btn.delete {
            background: #e53935;
            color: white;
        }

        /* Í±∞Îûò ÏÉÅÏÑ∏ Î™®Îã¨ */
        .trade-detail-modal {
            max-width: 500px;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-ticker {
            font-size: 28px;
            color: var(--text-primary);
            margin: 0;
            transition: color 0.3s;
        }

        .detail-type {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .detail-type.buy {
            background: rgba(76, 175, 80, 0.15);
            color: var(--profit-color);
        }

        .detail-type.sell {
            background: rgba(229, 57, 53, 0.15);
            color: var(--loss-color);
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-item {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            transition: background 0.3s;
        }

        .detail-item.full {
            grid-column: 1 / -1;
        }

        .detail-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .detail-value {
            font-size: 18px;
            color: var(--text-primary);
            font-weight: 600;
            transition: color 0.3s;
        }

        .detail-value.large {
            font-size: 24px;
        }

        .detail-memo-section {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: background 0.3s;
        }

        .detail-memo {
            font-size: 15px;
            color: var(--text-secondary);
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            margin-top: 8px;
            transition: color 0.3s;
        }

        /* ÌÖåÏù¥Î∏î Ìñâ ÌÅ¥Î¶≠ Í∞ÄÎä• ÌëúÏãú */
        #tradeTableBody tr {
            cursor: pointer;
        }

        #tradeTableBody tr:hover {
            background: var(--hover-bg);
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 600px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-grid {
                grid-template-columns: 1fr 1fr;
            }

            .page-title {
                font-size: 24px;
            }

            .portfolio-grid {
                grid-template-columns: 1fr;
            }

            .portfolio-summary {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ÏÉÅÎã®Î∞î -->
    <div class="top-bar">
        <div class="left-section">
            <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
            <a href="https://github.com/Minsu-code" target="_blank" class="social-link" title="GitHub">
                <svg class="x-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
            <a href="https://x.com/KR_MSU" target="_blank" class="social-link" title="X (Twitter)">
                <svg class="x-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
            </a>
            <a href="index.html" class="social-link" title="Home">
                <svg class="x-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 3L4 9v12h5v-7h6v7h5V9l-8-6z"/>
                </svg>
            </a>
        </div>

        <a href="project.html" class="nav-link">Project</a>

        <div class="visitor-count">
            Î∞©Î¨∏Ïûê : <span id="visitorCount">-</span>Ìöå
        </div>
    </div>
    
    <div class="main-content">
        <h1 class="page-title">üìä Trading Journal</h1>

        <!-- ÏãúÎìúÎ®∏Îãà Í¥ÄÎ¶¨ -->
        <div class="seed-container">
            <div class="seed-card">
                <div class="seed-info">
                    <div class="seed-label">üí∞ Total Assets (USD)</div>
                    <div class="seed-value" id="currentSeed">$0</div>
                    <div class="seed-krw" id="currentSeedKRW">‚âà ‚Ç©0</div>
                </div>
                <div class="seed-info">
                    <div class="seed-label">üíµ Cash (USD)</div>
                    <div class="seed-value" id="currentCash">$0</div>
                    <button class="cash-edit-btn" onclick="editCash()">‚úèÔ∏è</button>
                </div>
                <div class="seed-actions">
                    <button class="seed-btn add" onclick="openSeedModal('add_usd')">+ USD</button>
                    <button class="seed-btn add" onclick="openSeedModal('add_krw')">+ KRW</button>
                    <button class="seed-btn remove" onclick="openSeedModal('remove_usd')">- USD</button>
                    <button class="seed-btn remove" onclick="openSeedModal('remove_krw')">- KRW</button>
                    <button class="seed-btn exchange" onclick="openSeedModal('krw_to_usd')">‚Ç©‚Üí$</button>
                    <button class="seed-btn exchange" onclick="openSeedModal('usd_to_krw')">$‚Üí‚Ç©</button>
                    <button class="seed-btn history" onclick="toggleSeedHistory()">üìã</button>
                </div>
            </div>
            <div class="exchange-rate-card">
                <div class="rate-label">üí± Exchange Rate</div>
                <div class="rate-input-group">
                    <span>$1 = ‚Ç©</span>
                    <input type="number" id="exchangeRate" value="1450" step="0.01" readonly>
                    <button class="rate-edit-btn" onclick="editExchangeRate()">‚úèÔ∏è</button>
                </div>
            </div>
        </div>

        <!-- ÏãúÎìúÎ®∏Îãà ÌûàÏä§ÌÜ†Î¶¨ -->
        <div class="seed-history-container" id="seedHistoryContainer" style="display: none;">
            <div class="table-container">
                <div class="table-header">
                    <h2 class="table-title">üí∞ Seed Money History</h2>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Memo</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="seedTableBody">
                        <tr>
                            <td colspan="5" class="empty-message">No seed money records yet.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ÌÜµÍ≥Ñ -->
        <div class="stats-header">
            <h2 class="stats-title">üìà Statistics</h2>
            <div class="period-filter">
                <button class="period-btn active" onclick="setPeriod('all')">All</button>
                <button class="period-btn" onclick="setPeriod('day')">Day</button>
                <button class="period-btn" onclick="setPeriod('week')">Week</button>
                <button class="period-btn" onclick="setPeriod('month')">Month</button>
                <button class="period-btn" onclick="setPeriod('year')">Year</button>
            </div>
        </div>
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-label">Total Trades</div>
                <div class="stat-value" id="totalTrades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Win Rate</div>
                <div class="stat-value" id="winRate">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Profit</div>
                <div class="stat-value" id="totalProfit">$0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Return</div>
                <div class="stat-value" id="avgReturn">0%</div>
            </div>
        </div>

        <!-- ÏûÖÎ†• Ìèº -->
        <div class="form-container">
            <h2 class="form-title">‚úèÔ∏è New Trade</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="tradeDate">
                </div>
                <div class="form-group">
                    <label>Ticker</label>
                    <input type="text" id="ticker" placeholder="ex) AAPL, TSLA, BTC">
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="tradeType">
                        <option value="buy">Buy</option>
                        <option value="sell">Sell</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" id="quantity" placeholder="0" step="any">
                </div>
                <div class="form-group">
                    <label>Price ($)</label>
                    <input type="number" id="price" placeholder="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="category">
                        <option value="stock">Stock</option>
                        <option value="coin">Coin</option>
                        <option value="etf">ETF</option>
                    </select>
                </div>
                <div class="form-group full-width">
                    <label>Memo</label>
                    <textarea id="memo" placeholder="Why did you make this trade?"></textarea>
                </div>
            </div>
            <div class="btn-container">
                <button class="btn" onclick="addTrade()">Add Trade</button>
            </div>
        </div>

        <!-- Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏÑπÏÖò -->
        <div class="portfolio-container">
            <div class="portfolio-table-container">
                <div class="table-header">
                    <h2 class="table-title">üíº Portfolio</h2>
                </div>
                <table class="portfolio-table">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Return %</th>
                            <th>Profit</th>
                            <th>Avg Price</th>
                            <th>Current Price</th>
                            <th>Quantity</th>
                            <th>Value</th>
                            <th>Cost</th>
                            <th>Value (‚Ç©)</th>
                        </tr>
                    </thead>
                    <tbody id="portfolioTableBody">
                        <tr>
                            <td colspan="9" class="portfolio-empty">No holdings yet. Start buying to build your portfolio!</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Îß§Îß§ Í∏∞Î°ù ÌÖåÏù¥Î∏î -->
        <div class="table-container">
            <div class="table-header">
                <h2 class="table-title">üìã Trade History</h2>
                <div class="filter-group">
                    <select id="filterCategory" onchange="renderTrades()">
                        <option value="all">All Categories</option>
                        <option value="stock">Stock</option>
                        <option value="coin">Coin</option>
                        <option value="etf">ETF</option>
                    </select>
                    <select id="filterType" onchange="renderTrades()">
                        <option value="all">All Types</option>
                        <option value="buy">Buy</option>
                        <option value="sell">Sell</option>
                    </select>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Ticker</th>
                        <th>Type</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Total</th>
                        <th>Category</th>
                        <th>Memo</th>
                    </tr>
                </thead>
                <tbody id="tradeTableBody">
                    <tr>
                        <td colspan="9" class="empty-message">No trades yet. Start logging your trades!</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ÏãúÎìúÎ®∏Îãà Î™®Îã¨ -->
    <div class="modal" id="seedModal">
        <div class="modal-content">
            <h3 class="modal-title" id="seedModalTitle">Add Seed Money</h3>
            <div class="form-group" id="amountGroup">
                <label id="amountLabel">Amount ($)</label>
                <input type="number" id="seedAmount" placeholder="0" step="0.01">
            </div>
            <div class="form-group" id="rateGroup" style="display: none;">
                <label>Exchange Rate ($1 = ‚Ç©)</label>
                <input type="number" id="seedExchangeRate" placeholder="1450" step="0.01">
            </div>
            <div class="form-group">
                <label>Memo</label>
                <input type="text" id="seedMemo" placeholder="ex) Monthly salary, Withdrawal...">
            </div>
            <div class="exchange-preview" id="exchangePreview" style="display: none;">
                <span id="previewText">$0 ‚Üí ‚Ç©0</span>
            </div>
            <div class="modal-buttons">
                <button class="btn" onclick="saveSeedMoney()">Save</button>
                <button class="btn cancel" onclick="closeSeedModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Í±∞Îûò ÏÉÅÏÑ∏ Î™®Îã¨ -->
    <div class="modal" id="tradeDetailModal">
        <div class="modal-content trade-detail-modal">
            <div class="detail-header">
                <h3 class="detail-ticker" id="detailTicker">AAPL</h3>
                <span class="detail-type" id="detailType">BUY</span>
            </div>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Date</div>
                    <div class="detail-value" id="detailDate">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Category</div>
                    <div class="detail-value" id="detailCategory">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Quantity</div>
                    <div class="detail-value" id="detailQuantity">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Price</div>
                    <div class="detail-value" id="detailPrice">-</div>
                </div>
                <div class="detail-item full">
                    <div class="detail-label">Total</div>
                    <div class="detail-value large" id="detailTotal">-</div>
                </div>
            </div>
            <div class="detail-memo-section">
                <div class="detail-label">Memo</div>
                <div class="detail-memo" id="detailMemo">-</div>
            </div>
            <div class="modal-buttons">
                <button class="btn" onclick="closeTradeDetail()">Close</button>
                <button class="btn delete" id="detailDeleteBtn" onclick="deleteTradeFromDetail()">üóëÔ∏è Delete</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = { 
            apiKey: "AIzaSyBqFDAe_mY7T8FWL-9dzjLd3yHgG_rZE6Q", 
            authDomain: "my-website-minsu.firebaseapp.com", 
            projectId: "my-website-minsu", 
            storageBucket: "my-website-minsu.firebasestorage.app", 
            messagingSenderId: "766576447022", 
            appId: "1:766576447022:web:4b03228299fcf0f39f99bf", 
            measurementId: "G-ND5YSMW9VH" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let trades = [];
        let seedHistory = [];
        let currentSeedType = 'add';
        let currentTradeId = null;
        let currentPeriod = 'all';
        const ADMIN_PASSWORD = 'Dpfsleh105~';

        // ÌòÑÏû¨Í∞Ä Ï†ÄÏû•ÏÜå
        let currentPrices = {};

        // ÌòÑÏû¨Í∞Ä Î°úÎìú
        async function loadCurrentPrices() {
            try {
                const snapshot = await db.collection('currentPrices').get();
                currentPrices = {};
                snapshot.forEach(doc => {
                    currentPrices[doc.id] = doc.data().price;
                });
            } catch (error) {
                console.log('Error loading current prices:', error);
            }
        }

        // ÌòÑÏû¨Í∞Ä Ï†ÄÏû•
        async function saveCurrentPrice(ticker, price) {
            try {
                await db.collection('currentPrices').doc(ticker).set({ 
                    price: price,
                    updatedAt: new Date().toISOString()
                });
                currentPrices[ticker] = price;
            } catch (error) {
                console.log('Error saving current price:', error);
            }
        }

        // ÌòÑÏû¨Í∞Ä ÏàòÏ†ï
        function editCurrentPrice(ticker) {
            const password = prompt('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (password !== ADMIN_PASSWORD) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§! üö´');
                return;
            }
            
            const currentPrice = currentPrices[ticker] || 0;
            const newPrice = prompt(`${ticker}Ïùò ÌòÑÏû¨Í∞ÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî ($):`, currentPrice);
            
            if (newPrice !== null && !isNaN(parseFloat(newPrice))) {
                saveCurrentPrice(ticker, parseFloat(newPrice));
                updatePortfolio();
                updateCurrentSeed(); // ÏãúÎìúÎ®∏ÎãàÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            }
        }

        // Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Í≥ÑÏÇ∞ Î∞è Î†åÎçîÎßÅ
        function updatePortfolio() {
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 1450;
            const holdings = {};
            
            // Ï¢ÖÎ™©Î≥Ñ Î≥¥Ïú†Îüâ Í≥ÑÏÇ∞
            trades.forEach(trade => {
                if (!holdings[trade.ticker]) {
                    holdings[trade.ticker] = {
                        ticker: trade.ticker,
                        category: trade.category,
                        quantity: 0,
                        totalCost: 0,
                        buyTrades: [],
                        sellTrades: []
                    };
                }
                
                if (trade.type === 'buy') {
                    holdings[trade.ticker].quantity += trade.quantity;
                    holdings[trade.ticker].totalCost += trade.quantity * trade.price;
                    holdings[trade.ticker].buyTrades.push(trade);
                } else {
                    holdings[trade.ticker].quantity -= trade.quantity;
                    // Îß§ÎèÑ Ïãú ÏõêÍ∏àÏóêÏÑú ÎπÑÎ°Ä Ï∞®Í∞ê
                    const avgCost = holdings[trade.ticker].totalCost / (holdings[trade.ticker].quantity + trade.quantity);
                    holdings[trade.ticker].totalCost -= trade.quantity * avgCost;
                    holdings[trade.ticker].sellTrades.push(trade);
                }
            });
            
            // Î≥¥Ïú† Ï§ëÏù∏ Ï¢ÖÎ™©Îßå ÌïÑÌÑ∞ÎßÅ (ÏàòÎüâ > 0)
            const activeHoldings = Object.values(holdings).filter(h => h.quantity > 0.0001);
            
            const tbody = document.getElementById('portfolioTableBody');
            
            if (activeHoldings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="portfolio-empty">No holdings yet. Start buying to build your portfolio!</td></tr>';
                return;
            }
            
            // Í∞Å Ï¢ÖÎ™© Í≥ÑÏÇ∞
            let totalCost = 0;
            let totalValue = 0;
            
            activeHoldings.forEach(h => {
                const totalBought = h.buyTrades.reduce((sum, t) => sum + t.quantity, 0);
                h.avgPrice = h.buyTrades.reduce((sum, t) => sum + t.price * t.quantity, 0) / totalBought;
                h.cost = h.quantity * h.avgPrice; // ÏõêÍ∏à
                h.currentPrice = currentPrices[h.ticker] || h.avgPrice; // ÌòÑÏû¨Í∞Ä (ÏóÜÏúºÎ©¥ ÌèâÍ∑†Îß§ÏàòÍ∞Ä)
                h.value = h.quantity * h.currentPrice; // ÌèâÍ∞ÄÍ∏à
                h.valueKRW = h.value * exchangeRate; // ÏõêÌôî ÌèâÍ∞ÄÍ∏à
                h.profit = h.value - h.cost; // ÏàòÏùµÍ∏à
                h.returnPct = ((h.currentPrice - h.avgPrice) / h.avgPrice) * 100; // ÏàòÏùµÎ•†
                
                totalCost += h.cost;
                totalValue += h.value;
            });
            
            // ÌèâÍ∞ÄÍ∏à Í∏∞Ï§Ä ÎÇ¥Î¶ºÏ∞®Ïàú Ï†ïÎ†¨
            activeHoldings.sort((a, b) => b.value - a.value);
            
            // ÌÖåÏù¥Î∏î Î†åÎçîÎßÅ
            let html = activeHoldings.map(h => `
                <tr>
                    <td class="portfolio-ticker-cell">${h.ticker}</td>
                    <td class="${h.returnPct >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${h.returnPct >= 0 ? '+' : ''}${h.returnPct.toFixed(2)}%
                    </td>
                    <td class="${h.profit >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${h.profit >= 0 ? '+' : ''}$${h.profit.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                    </td>
                    <td>$${h.avgPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>
                        <div class="current-price-cell">
                            <span>$${h.currentPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                            <button class="price-edit-btn" onclick="editCurrentPrice('${h.ticker}')" title="Edit price">‚úèÔ∏è</button>
                        </div>
                    </td>
                    <td>${h.quantity.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 4})}</td>
                    <td>$${h.value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>$${h.cost.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>‚Ç©${Math.round(h.valueKRW).toLocaleString()}</td>
                </tr>
            `).join('');
            
            // Ìï©Í≥Ñ Ìñâ Ï∂îÍ∞Ä
            const totalProfit = totalValue - totalCost;
            const totalReturnPct = totalCost > 0 ? ((totalValue - totalCost) / totalCost) * 100 : 0;
            const totalValueKRW = totalValue * exchangeRate;
            
            html += `
                <tr class="portfolio-total-row">
                    <td><strong>TOTAL</strong></td>
                    <td class="${totalReturnPct >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${totalReturnPct >= 0 ? '+' : ''}${totalReturnPct.toFixed(2)}%
                    </td>
                    <td class="${totalProfit >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${totalProfit >= 0 ? '+' : ''}$${totalProfit.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                    </td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td><strong>$${totalValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
                    <td><strong>$${totalCost.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
                    <td><strong>‚Ç©${Math.round(totalValueKRW).toLocaleString()}</strong></td>
                </tr>
            `;
            
            tbody.innerHTML = html;
        }

        // Í±∞Îûò ÏÉÅÏÑ∏ Î≥¥Í∏∞
        function openTradeDetail(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;

            currentTradeId = id;

            document.getElementById('detailTicker').textContent = trade.ticker;
            
            const typeEl = document.getElementById('detailType');
            typeEl.textContent = trade.type.toUpperCase();
            typeEl.className = 'detail-type ' + trade.type;

            document.getElementById('detailDate').textContent = trade.date;
            document.getElementById('detailCategory').textContent = trade.category.toUpperCase();
            document.getElementById('detailQuantity').textContent = trade.quantity.toLocaleString();
            document.getElementById('detailPrice').textContent = '$' + trade.price.toLocaleString();
            document.getElementById('detailTotal').textContent = '$' + trade.total.toLocaleString();
            document.getElementById('detailMemo').textContent = trade.memo || 'No memo';

            document.getElementById('tradeDetailModal').classList.add('active');
        }

        function closeTradeDetail() {
            document.getElementById('tradeDetailModal').classList.remove('active');
            currentTradeId = null;
        }

        async function deleteTradeFromDetail() {
            if (!currentTradeId) return;

            const password = prompt('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (password !== ADMIN_PASSWORD) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§! üö´');
                return;
            }
            if (!confirm('Delete this trade?')) return;

            try {
                await db.collection('trades').doc(currentTradeId).delete();
                closeTradeDetail();
                loadTrades();
            } catch (error) {
                alert('Error deleting trade: ' + error.message);
            }
        }

        // Îã§ÌÅ¨Î™®Îìú
        function toggleTheme() {
            const body = document.body;
            const button = document.querySelector('.theme-toggle');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                button.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                button.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const button = document.querySelector('.theme-toggle');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                button.textContent = '‚òÄÔ∏è';
            }
        }

        // Ïò§Îäò ÎÇ†Ïßú Í∏∞Î≥∏Í∞í
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tradeDate').value = today;
        }

        // Îß§Îß§ Ï∂îÍ∞Ä
        async function addTrade() {
            const password = prompt('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (password !== ADMIN_PASSWORD) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§! üö´');
                return;
            }

            const date = document.getElementById('tradeDate').value;
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            const type = document.getElementById('tradeType').value;
            const quantity = parseFloat(document.getElementById('quantity').value);
            const price = parseFloat(document.getElementById('price').value);
            const category = document.getElementById('category').value;
            const memo = document.getElementById('memo').value.trim();

            if (!date || !ticker || !quantity || !price) {
                alert('Please fill in all required fields!');
                return;
            }

            const trade = {
                date,
                ticker,
                type,
                quantity,
                price,
                total: quantity * price,
                category,
                memo,
                createdAt: new Date().toISOString()
            };

            try {
                await db.collection('trades').add(trade);
                
                // Ìèº Ï¥àÍ∏∞Ìôî
                document.getElementById('ticker').value = '';
                document.getElementById('quantity').value = '';
                document.getElementById('price').value = '';
                document.getElementById('memo').value = '';
                
                loadTrades();
            } catch (error) {
                alert('Error saving trade: ' + error.message);
            }
        }

        // Îß§Îß§ Í∏∞Î°ù Î∂àÎü¨Ïò§Í∏∞
        async function loadTrades() {
            try {
                const snapshot = await db.collection('trades').orderBy('date', 'desc').get();
                trades = [];
                snapshot.forEach(doc => {
                    trades.push({ id: doc.id, ...doc.data() });
                });
                renderTrades();
                updateStats();
                updateCurrentSeed();
                updatePortfolio();
            } catch (error) {
                console.log('Error loading trades:', error);
            }
        }

        // Îß§Îß§ Í∏∞Î°ù Î†åÎçîÎßÅ
        function renderTrades() {
            const tbody = document.getElementById('tradeTableBody');
            const categoryFilter = document.getElementById('filterCategory').value;
            const typeFilter = document.getElementById('filterType').value;

            let filteredTrades = trades;

            if (categoryFilter !== 'all') {
                filteredTrades = filteredTrades.filter(t => t.category === categoryFilter);
            }
            if (typeFilter !== 'all') {
                filteredTrades = filteredTrades.filter(t => t.type === typeFilter);
            }

            if (filteredTrades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-message">No trades found.</td></tr>';
                return;
            }

            tbody.innerHTML = filteredTrades.map(trade => `
                <tr onclick="openTradeDetail('${trade.id}')">
                    <td>${trade.date}</td>
                    <td><strong>${trade.ticker}</strong></td>
                    <td class="${trade.type === 'buy' ? 'type-buy' : 'type-sell'}">${trade.type.toUpperCase()}</td>
                    <td>${trade.quantity.toLocaleString()}</td>
                    <td>$${trade.price.toLocaleString()}</td>
                    <td>$${trade.total.toLocaleString()}</td>
                    <td>${trade.category.toUpperCase()}</td>
                    <td class="memo-cell" title="${trade.memo}">${trade.memo || '-'}</td>
                </tr>
            `).join('');
        }

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStats() {
            // Í∏∞Í∞ÑÎ≥Ñ ÌïÑÌÑ∞ÎßÅ
            const filteredTrades = getFilteredTradesByPeriod(trades);
            
            // Ï¢ÖÎ™©Î≥Ñ Îß§Îß§ Í∑∏Î£πÌôî
            const tradesByTicker = {};
            
            filteredTrades.forEach(trade => {
                if (!tradesByTicker[trade.ticker]) {
                    tradesByTicker[trade.ticker] = { buys: [], sells: [] };
                }
                if (trade.type === 'buy') {
                    tradesByTicker[trade.ticker].buys.push(trade);
                } else {
                    tradesByTicker[trade.ticker].sells.push(trade);
                }
            });

            let totalProfit = 0;
            let completedTrades = 0;
            let winningTrades = 0;
            let totalReturn = 0;

            // ÏôÑÎ£åÎêú Í±∞Îûò Í≥ÑÏÇ∞ (Îß§Ïàò + Îß§ÎèÑ ÏûàÎäî Í≤ΩÏö∞)
            Object.keys(tradesByTicker).forEach(ticker => {
                const { buys, sells } = tradesByTicker[ticker];
                
                if (buys.length > 0 && sells.length > 0) {
                    const avgBuyPrice = buys.reduce((sum, t) => sum + t.price * t.quantity, 0) / buys.reduce((sum, t) => sum + t.quantity, 0);
                    const avgSellPrice = sells.reduce((sum, t) => sum + t.price * t.quantity, 0) / sells.reduce((sum, t) => sum + t.quantity, 0);
                    const soldQty = Math.min(
                        buys.reduce((sum, t) => sum + t.quantity, 0),
                        sells.reduce((sum, t) => sum + t.quantity, 0)
                    );
                    
                    const profit = (avgSellPrice - avgBuyPrice) * soldQty;
                    const returnPct = ((avgSellPrice - avgBuyPrice) / avgBuyPrice) * 100;
                    
                    totalProfit += profit;
                    totalReturn += returnPct;
                    completedTrades++;
                    
                    if (profit > 0) winningTrades++;
                }
            });

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('totalTrades').textContent = filteredTrades.length;
            
            const winRate = completedTrades > 0 ? Math.round((winningTrades / completedTrades) * 100) : 0;
            document.getElementById('winRate').textContent = winRate + '%';
            
            const profitEl = document.getElementById('totalProfit');
            profitEl.textContent = (totalProfit >= 0 ? '+$' : '-$') + Math.abs(totalProfit).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            profitEl.className = 'stat-value ' + (totalProfit >= 0 ? 'profit' : 'loss');
            
            const avgReturn = completedTrades > 0 ? (totalReturn / completedTrades).toFixed(1) : 0;
            const avgReturnEl = document.getElementById('avgReturn');
            avgReturnEl.textContent = (avgReturn >= 0 ? '+' : '') + avgReturn + '%';
            avgReturnEl.className = 'stat-value ' + (avgReturn >= 0 ? 'profit' : 'loss');
        }

        // Î∞©Î¨∏Ïûê Ïàò Î°úÎìú
        async function loadVisitorCount() {
            try {
                const visitorRef = db.collection('stats').doc('visitors');
                const doc = await visitorRef.get();
                
                if (doc.exists) {
                    document.getElementById('visitorCount').textContent = doc.data().count || 0;
                }
            } catch (error) {
                document.getElementById('visitorCount').textContent = '-';
            }
        }

        // Ï¥àÍ∏∞Ìôî
        window.onload = async function() {
            loadTheme();
            loadExchangeRate();
            setDefaultDate();
            await loadCurrentPrices();
            await loadCashBalance();
            loadTrades();
            loadSeedHistory();
            loadVisitorCount();
        };

        // ÏãúÎìúÎ®∏Îãà Î™®Îã¨
        function openSeedModal(type) {
            const password = prompt('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (password !== ADMIN_PASSWORD) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§! üö´');
                return;
            }
            currentSeedType = type;
            
            const titleEl = document.getElementById('seedModalTitle');
            const labelEl = document.getElementById('amountLabel');
            const rateGroup = document.getElementById('rateGroup');
            const previewEl = document.getElementById('exchangePreview');
            const rateInput = document.getElementById('seedExchangeRate');
            
            rateInput.value = document.getElementById('exchangeRate').value;
            rateGroup.style.display = 'none';
            previewEl.style.display = 'none';
            
            switch(type) {
                case 'add_usd':
                    titleEl.textContent = 'üíµ Add USD';
                    labelEl.textContent = 'Amount ($)';
                    break;
                case 'add_krw':
                    titleEl.textContent = 'üí¥ Add KRW';
                    labelEl.textContent = 'Amount (‚Ç©)';
                    break;
                case 'remove_usd':
                    titleEl.textContent = 'üí∏ Remove USD';
                    labelEl.textContent = 'Amount ($)';
                    break;
                case 'remove_krw':
                    titleEl.textContent = 'üí∏ Remove KRW';
                    labelEl.textContent = 'Amount (‚Ç©)';
                    break;
                case 'krw_to_usd':
                    titleEl.textContent = 'üí± KRW ‚Üí USD';
                    labelEl.textContent = 'KRW Amount (‚Ç©)';
                    rateGroup.style.display = 'block';
                    previewEl.style.display = 'block';
                    break;
                case 'usd_to_krw':
                    titleEl.textContent = 'üí± USD ‚Üí KRW';
                    labelEl.textContent = 'USD Amount ($)';
                    rateGroup.style.display = 'block';
                    previewEl.style.display = 'block';
                    break;
            }
            
            document.getElementById('seedAmount').value = '';
            document.getElementById('seedMemo').value = '';
            document.getElementById('seedModal').classList.add('active');
            
            // ÌôòÏ†Ñ ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('seedAmount').oninput = updateExchangePreview;
            document.getElementById('seedExchangeRate').oninput = updateExchangePreview;
        }

        function updateExchangePreview() {
            const amount = parseFloat(document.getElementById('seedAmount').value) || 0;
            const rate = parseFloat(document.getElementById('seedExchangeRate').value) || 1450;
            const previewEl = document.getElementById('previewText');
            
            if (currentSeedType === 'krw_to_usd') {
                const usd = amount / rate;
                previewEl.textContent = `‚Ç©${amount.toLocaleString()} ‚Üí $${usd.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            } else if (currentSeedType === 'usd_to_krw') {
                const krw = amount * rate;
                previewEl.textContent = `$${amount.toLocaleString()} ‚Üí ‚Ç©${krw.toLocaleString()}`;
            }
        }

        function closeSeedModal() {
            document.getElementById('seedModal').classList.remove('active');
        }

        async function saveSeedMoney() {
            const amount = parseFloat(document.getElementById('seedAmount').value);
            const memo = document.getElementById('seedMemo').value.trim();
            const exchangeRate = parseFloat(document.getElementById('seedExchangeRate').value) || parseFloat(document.getElementById('exchangeRate').value);

            if (!amount || amount <= 0) {
                alert('Please enter a valid amount!');
                return;
            }

            let record = {
                memo,
                date: new Date().toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };

            switch(currentSeedType) {
                case 'add_usd':
                    record.type = 'add_usd';
                    record.amountUSD = amount;
                    record.amountKRW = 0;
                    record.displayAmount = amount;
                    record.displayCurrency = 'USD';
                    break;
                case 'add_krw':
                    record.type = 'add_krw';
                    record.amountUSD = 0;
                    record.amountKRW = amount;
                    record.displayAmount = amount;
                    record.displayCurrency = 'KRW';
                    break;
                case 'remove_usd':
                    record.type = 'remove_usd';
                    record.amountUSD = -amount;
                    record.amountKRW = 0;
                    record.displayAmount = amount;
                    record.displayCurrency = 'USD';
                    break;
                case 'remove_krw':
                    record.type = 'remove_krw';
                    record.amountUSD = 0;
                    record.amountKRW = -amount;
                    record.displayAmount = amount;
                    record.displayCurrency = 'KRW';
                    break;
                case 'krw_to_usd':
                    const usdAmount = amount / exchangeRate;
                    record.type = 'krw_to_usd';
                    record.amountUSD = usdAmount;
                    record.amountKRW = -amount;
                    record.displayAmount = amount;
                    record.displayCurrency = 'KRW';
                    record.exchangeRate = exchangeRate;
                    record.convertedAmount = usdAmount;
                    break;
                case 'usd_to_krw':
                    const krwAmount = amount * exchangeRate;
                    record.type = 'usd_to_krw';
                    record.amountUSD = -amount;
                    record.amountKRW = krwAmount;
                    record.displayAmount = amount;
                    record.displayCurrency = 'USD';
                    record.exchangeRate = exchangeRate;
                    record.convertedAmount = krwAmount;
                    break;
            }

            try {
                await db.collection('seedMoney').add(record);
                closeSeedModal();
                loadSeedHistory();
            } catch (error) {
                alert('Error saving: ' + error.message);
            }
        }

        async function loadSeedHistory() {
            try {
                const snapshot = await db.collection('seedMoney').orderBy('createdAt', 'desc').get();
                seedHistory = [];
                snapshot.forEach(doc => {
                    seedHistory.push({ id: doc.id, ...doc.data() });
                });
                renderSeedHistory();
                updateCurrentSeed();
            } catch (error) {
                console.log('Error loading seed history:', error);
            }
        }

        function renderSeedHistory() {
            const tbody = document.getElementById('seedTableBody');

            if (seedHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-message">No seed money records yet.</td></tr>';
                return;
            }

            tbody.innerHTML = seedHistory.map(record => {
                let typeText = '';
                let typeClass = '';
                let amountText = '';
                
                switch(record.type) {
                    case 'add_usd':
                        typeText = '+ USD';
                        typeClass = 'type-add';
                        amountText = '$' + record.displayAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                        break;
                    case 'add_krw':
                        typeText = '+ KRW';
                        typeClass = 'type-add';
                        amountText = '‚Ç©' + record.displayAmount.toLocaleString();
                        break;
                    case 'remove_usd':
                        typeText = '- USD';
                        typeClass = 'type-remove';
                        amountText = '$' + record.displayAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                        break;
                    case 'remove_krw':
                        typeText = '- KRW';
                        typeClass = 'type-remove';
                        amountText = '‚Ç©' + record.displayAmount.toLocaleString();
                        break;
                    case 'krw_to_usd':
                        typeText = '‚Ç©‚Üí$';
                        typeClass = 'type-exchange';
                        amountText = '‚Ç©' + record.displayAmount.toLocaleString() + ' ‚Üí $' + record.convertedAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                        break;
                    case 'usd_to_krw':
                        typeText = '$‚Üí‚Ç©';
                        typeClass = 'type-exchange';
                        amountText = '$' + record.displayAmount.toLocaleString() + ' ‚Üí ‚Ç©' + record.convertedAmount.toLocaleString();
                        break;
                    default:
                        // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Ìò∏Ìôò
                        typeText = record.type === 'add' ? '+ ADD' : '- REMOVE';
                        typeClass = record.type === 'add' ? 'type-add' : 'type-remove';
                        amountText = '$' + (record.displayAmount || Math.abs(record.amount)).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                }
                
                return `
                <tr>
                    <td>${record.date}</td>
                    <td class="${typeClass}">${typeText}</td>
                    <td>${amountText}</td>
                    <td class="memo-cell" title="${record.memo}">${record.memo || '-'}</td>
                    <td><button class="delete-btn" onclick="deleteSeedRecord('${record.id}')">üóëÔ∏è</button></td>
                </tr>
            `}).join('');
        }

        // Î≥¥Ïú† ÌòÑÍ∏à Î≥ÄÏàò
        let manualCashUSD = null;

        // Î≥¥Ïú† ÌòÑÍ∏à Î°úÎìú
        async function loadCashBalance() {
            try {
                const doc = await db.collection('settings').doc('cashBalance').get();
                if (doc.exists) {
                    manualCashUSD = doc.data().amount;
                }
            } catch (error) {
                console.log('Error loading cash balance:', error);
            }
        }

        // Î≥¥Ïú† ÌòÑÍ∏à Ï†ÄÏû•
        async function saveCashBalance(amount) {
            try {
                await db.collection('settings').doc('cashBalance').set({
                    amount: amount,
                    updatedAt: new Date().toISOString()
                });
                manualCashUSD = amount;
            } catch (error) {
                console.log('Error saving cash balance:', error);
            }
        }

        // Î≥¥Ïú† ÌòÑÍ∏à ÏàòÏ†ï
        function editCash() {
            const password = prompt('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (password !== ADMIN_PASSWORD) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§! üö´');
                return;
            }
            
            const currentCash = manualCashUSD || 0;
            const newCash = prompt('Î≥¥Ïú† ÌòÑÍ∏àÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî ($):', currentCash);
            
            if (newCash !== null && !isNaN(parseFloat(newCash))) {
                saveCashBalance(parseFloat(newCash));
                updateCurrentSeed();
            }
        }

        function updateCurrentSeed() {
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 1450;
            
            // ÌòÑÏû¨ Î≥¥Ïú† Ï£ºÏãù Í≥ÑÏÇ∞
            const holdings = {};
            trades.forEach(trade => {
                if (!holdings[trade.ticker]) {
                    holdings[trade.ticker] = {
                        ticker: trade.ticker,
                        quantity: 0,
                        buyTrades: []
                    };
                }
                
                if (trade.type === 'buy') {
                    holdings[trade.ticker].quantity += trade.quantity;
                    holdings[trade.ticker].buyTrades.push(trade);
                } else {
                    holdings[trade.ticker].quantity -= trade.quantity;
                }
            });
            
            // Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÌèâÍ∞ÄÍ∏à Í≥ÑÏÇ∞ (ÌòÑÏû¨Í∞Ä Í∏∞Ï§Ä)
            let portfolioValue = 0;
            Object.values(holdings).forEach(h => {
                if (h.quantity > 0.0001) {
                    const totalBought = h.buyTrades.reduce((sum, t) => sum + t.quantity, 0);
                    const avgPrice = h.buyTrades.reduce((sum, t) => sum + t.price * t.quantity, 0) / totalBought;
                    const currentPrice = currentPrices[h.ticker] || avgPrice;
                    portfolioValue += h.quantity * currentPrice;
                }
            });
            
            // Î≥¥Ïú† ÌòÑÍ∏à (ÏßÅÏ†ë ÏÑ§Ï†ïÌïú Í∞í ÏÇ¨Ïö©)
            const availableCash = manualCashUSD || 0;
            
            // Ï¥ù ÏûêÏÇ∞ = Î≥¥Ïú† ÌòÑÍ∏à + Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÌèâÍ∞ÄÍ∏à
            const totalAssetUSD = availableCash + portfolioValue;
            
            // Cash ÌëúÏãú
            document.getElementById('currentCash').textContent = '$' + availableCash.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            // Total Assets ÌëúÏãú
            document.getElementById('currentSeed').textContent = '$' + totalAssetUSD.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('currentSeedKRW').textContent = '‚âà ‚Ç©' + Math.round(totalAssetUSD * exchangeRate).toLocaleString();
        }
        
        function saveExchangeRate() {
            const rate = document.getElementById('exchangeRate').value;
            localStorage.setItem('exchangeRate', rate);
        }
        
        function loadExchangeRate() {
            const savedRate = localStorage.getItem('exchangeRate');
            if (savedRate) {
                document.getElementById('exchangeRate').value = savedRate;
            }
        }

        function editExchangeRate() {
            const password = prompt('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (password !== ADMIN_PASSWORD) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§! üö´');
                return;
            }
            
            const currentRate = document.getElementById('exchangeRate').value;
            const newRate = prompt('ÏÉà ÌôòÏú®ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî ($1 = ‚Ç©):', currentRate);
            
            if (newRate && !isNaN(parseFloat(newRate))) {
                document.getElementById('exchangeRate').value = parseFloat(newRate);
                saveExchangeRate();
                updateCurrentSeed();
                updatePortfolio();
            }
        }

        // Í∏∞Í∞Ñ ÌïÑÌÑ∞
        function setPeriod(period) {
            currentPeriod = period;
            
            // Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú Î≥ÄÍ≤Ω
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateStats();
        }

        function getFilteredTradesByPeriod(tradesArray) {
            if (currentPeriod === 'all') return tradesArray;
            
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            return tradesArray.filter(trade => {
                const tradeDate = new Date(trade.date);
                
                switch(currentPeriod) {
                    case 'day':
                        return tradeDate >= today;
                    case 'week':
                        const weekAgo = new Date(today);
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        return tradeDate >= weekAgo;
                    case 'month':
                        const monthAgo = new Date(today);
                        monthAgo.setMonth(monthAgo.getMonth() - 1);
                        return tradeDate >= monthAgo;
                    case 'year':
                        const yearAgo = new Date(today);
                        yearAgo.setFullYear(yearAgo.getFullYear() - 1);
                        return tradeDate >= yearAgo;
                    default:
                        return true;
                }
            });
        }

        async function deleteSeedRecord(id) {
            const password = prompt('ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (password !== ADMIN_PASSWORD) {
                alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§! üö´');
                return;
            }
            if (!confirm('Delete this record?')) return;

            try {
                await db.collection('seedMoney').doc(id).delete();
                loadSeedHistory();
            } catch (error) {
                alert('Error deleting: ' + error.message);
            }
        }

        function toggleSeedHistory() {
            const container = document.getElementById('seedHistoryContainer');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }
    </script>
</body>
</html>
